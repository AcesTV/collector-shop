apiVersion: apps/v1
kind: Deployment
metadata:
  name: catalog-service
  namespace: collector
spec:
  replicas: 2
  selector:
    matchLabels:
      app: catalog-service
  template:
    metadata:
      labels:
        app: catalog-service
    spec:
      automountServiceAccountToken: false
      containers:
        - name: catalog-service
          image: collector/catalog-service:1.0.0
          ports: [{containerPort: 3002}]
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
              ephemeral-storage: 256Mi
            limits:
              memory: 256Mi
              ephemeral-storage: 512Mi
          env:
            - {name: PORT, value: "3002"}
            - {name: DB_SCHEMA, value: catalog_service}
            - name: DB_PASSWORD
              valueFrom: {secretKeyRef: {name: db-credentials, key: DB_PASSWORD}}
          envFrom: [{configMapRef: {name: services-config}}]
          livenessProbe: {httpGet: {path: /health, port: 3002}, initialDelaySeconds: 30, periodSeconds: 10}
          readinessProbe: {httpGet: {path: /health, port: 3002}, initialDelaySeconds: 10, periodSeconds: 5}
---
apiVersion: v1
kind: Service
metadata: {name: catalog-service, namespace: collector}
spec: {selector: {app: catalog-service}, ports: [{port: 3002, targetPort: 3002}]}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: order-service
  namespace: collector
spec:
  replicas: 2
  selector:
    matchLabels:
      app: order-service
  template:
    metadata:
      labels:
        app: order-service
    spec:
      automountServiceAccountToken: false
      containers:
        - name: order-service
          image: collector/order-service:1.0.0
          ports: [{containerPort: 3003}]
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
              ephemeral-storage: 256Mi
            limits:
              memory: 256Mi
              ephemeral-storage: 512Mi
          env:
            - {name: PORT, value: "3003"}
            - {name: DB_SCHEMA, value: order_service}
            - name: DB_PASSWORD
              valueFrom: {secretKeyRef: {name: db-credentials, key: DB_PASSWORD}}
          envFrom: [{configMapRef: {name: services-config}}]
          livenessProbe: {httpGet: {path: /health, port: 3003}, initialDelaySeconds: 30, periodSeconds: 10}
---
apiVersion: v1
kind: Service
metadata: {name: order-service, namespace: collector}
spec: {selector: {app: order-service}, ports: [{port: 3003, targetPort: 3003}]}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: payment-service
  namespace: collector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: payment-service
  template:
    metadata:
      labels:
        app: payment-service
    spec:
      automountServiceAccountToken: false
      containers:
        - name: payment-service
          image: collector/payment-service:1.0.0
          ports: [{containerPort: 3004}]
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
              ephemeral-storage: 256Mi
            limits:
              memory: 256Mi
              ephemeral-storage: 512Mi
          env:
            - {name: PORT, value: "3004"}
            - {name: DB_SCHEMA, value: payment_service}
            - name: DB_PASSWORD
              valueFrom: {secretKeyRef: {name: db-credentials, key: DB_PASSWORD}}
          envFrom: [{configMapRef: {name: services-config}}]
          livenessProbe: {httpGet: {path: /health, port: 3004}, initialDelaySeconds: 30, periodSeconds: 10}
---
apiVersion: v1
kind: Service
metadata: {name: payment-service, namespace: collector}
spec: {selector: {app: payment-service}, ports: [{port: 3004, targetPort: 3004}]}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: notification-service
  namespace: collector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: notification-service
  template:
    metadata:
      labels:
        app: notification-service
    spec:
      automountServiceAccountToken: false
      containers:
        - name: notification-service
          image: collector/notification-service:1.0.0
          ports: [{containerPort: 3005}]
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
              ephemeral-storage: 256Mi
            limits:
              memory: 256Mi
              ephemeral-storage: 512Mi
          env:
            - {name: PORT, value: "3005"}
            - {name: DB_SCHEMA, value: notification_service}
            - name: DB_PASSWORD
              valueFrom: {secretKeyRef: {name: db-credentials, key: DB_PASSWORD}}
          envFrom: [{configMapRef: {name: services-config}}]
          livenessProbe: {httpGet: {path: /health, port: 3005}, initialDelaySeconds: 30, periodSeconds: 10}
---
apiVersion: v1
kind: Service
metadata: {name: notification-service, namespace: collector}
spec: {selector: {app: notification-service}, ports: [{port: 3005, targetPort: 3005}]}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: chat-service
  namespace: collector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: chat-service
  template:
    metadata:
      labels:
        app: chat-service
    spec:
      automountServiceAccountToken: false
      containers:
        - name: chat-service
          image: collector/chat-service:1.0.0
          ports: [{containerPort: 3006}]
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
              ephemeral-storage: 256Mi
            limits:
              memory: 256Mi
              ephemeral-storage: 512Mi
          env:
            - {name: PORT, value: "3006"}
            - {name: DB_SCHEMA, value: chat_service}
            - name: DB_PASSWORD
              valueFrom: {secretKeyRef: {name: db-credentials, key: DB_PASSWORD}}
          envFrom: [{configMapRef: {name: services-config}}]
---
apiVersion: v1
kind: Service
metadata: {name: chat-service, namespace: collector}
spec: {selector: {app: chat-service}, ports: [{port: 3006, targetPort: 3006}]}
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: fraud-service
  namespace: collector
spec:
  replicas: 1
  selector:
    matchLabels:
      app: fraud-service
  template:
    metadata:
      labels:
        app: fraud-service
    spec:
      automountServiceAccountToken: false
      containers:
        - name: fraud-service
          image: collector/fraud-service:1.0.0
          ports: [{containerPort: 3007}]
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
              ephemeral-storage: 256Mi
            limits:
              memory: 256Mi
              ephemeral-storage: 512Mi
          env:
            - {name: PORT, value: "3007"}
            - {name: DB_SCHEMA, value: fraud_service}
            - name: DB_PASSWORD
              valueFrom: {secretKeyRef: {name: db-credentials, key: DB_PASSWORD}}
          envFrom: [{configMapRef: {name: services-config}}]
          livenessProbe: {httpGet: {path: /health, port: 3007}, initialDelaySeconds: 30, periodSeconds: 10}
---
apiVersion: v1
kind: Service
metadata: {name: fraud-service, namespace: collector}
spec: {selector: {app: fraud-service}, ports: [{port: 3007, targetPort: 3007}]}
